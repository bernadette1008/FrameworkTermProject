<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì œì¶œ í˜„í™© - Ploytech ê³¼ì œ ì œì¶œ ì‹œìŠ¤í…œ</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #a8e6cf, #7fcdcd);
      font-family: 'Arial', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      background-color: #7fcdcd;
      padding: 15px;
      width: 100%;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .header-left {
      padding-left: 20px;
      display: flex;
      align-items: center;
    }

    .logo {
      width: 60px;
      height: 60px;
      background: #ffffff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .logo::before {
      content: "ğŸ’¡";
      font-size: 24px;
    }

    .title {
      font-size: 28px;
      font-weight: bold;
      color: #2c3e50;
    }

    .user-info {
      padding-right: 20px;
      display: flex;
      align-items: center;
      gap: 20px;
      color: #2c3e50;
      font-weight: bold;
    }

    .logout-btn, .back-btn {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .back-btn {
      background: #3498db;
    }

    .logout-btn:hover {
      background: #c0392b;
    }

    .back-btn:hover {
      background: #2980b9;
    }

    /*.container {*/
    /*  flex: 1;*/
    /*  max-width: 1200px;*/
    /*  margin: 0 auto;*/
    /*  padding: 20px;*/
    /*}*/

    .container {
      flex: 1;
      max-width: 1200px;
      min-width: 60%;
      margin: 0 auto;
      padding: 20px;
    }

    .page-header {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      text-align: center;
    }

    .page-title {
      font-size: 32px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 10px;
    }

    .page-subtitle {
      font-size: 16px;
      color: #7f8c8d;
    }

    .stats-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      text-align: center;
      border-left: 5px solid #7fcdcd;
    }

    .stat-number {
      font-size: 32px;
      font-weight: bold;
      color: #7fcdcd;
      margin-bottom: 8px;
    }

    .stat-label {
      color: #7f8c8d;
      font-size: 14px;
      font-weight: bold;
    }

    .submissions-section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }

    .section-title {
      font-size: 24px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .submissions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
    }

    .submission-card {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      border-left: 5px solid #7fcdcd;
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
    }

    .submission-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .submission-title {
      font-size: 18px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 10px;
    }

    .submission-info {
      color: #7f8c8d;
      font-size: 14px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .submission-content {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      border: 1px solid #e9ecef;
      font-size: 14px;
      line-height: 1.6;
      max-height: 100px;
      overflow-y: auto;
    }

    .submission-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
    }

    .score-badge {
      padding: 6px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: bold;
    }

    .score-graded {
      background: #d4edda;
      color: #155724;
    }

    .score-pending {
      background: #fff3cd;
      color: #856404;
    }

    .submission-date {
      font-size: 12px;
      color: #6c757d;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #7f8c8d;
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 20px;
    }

    .empty-state-text {
      font-size: 18px;
      margin-bottom: 10px;
    }

    .empty-state-subtext {
      font-size: 14px;
    }

    .filter-section {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .filter-title {
      font-size: 18px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 15px;
    }

    .filter-options {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 8px 16px;
      border: 2px solid #7fcdcd;
      background: white;
      color: #7fcdcd;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }

    .filter-btn.active {
      background: #7fcdcd;
      color: white;
    }

    .filter-btn:hover {
      background: #7fcdcd;
      color: white;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #7f8c8d;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #7fcdcd;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      .submissions-grid {
        grid-template-columns: 1fr;
      }

      .stats-section {
        grid-template-columns: repeat(2, 1fr);
      }

      .filter-options {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
<div class="header">
  <a class="header-left" th:href="@{/student/main}" style="text-decoration: none;">
    <div class="logo"></div>
    <div class="title">Ploytech ê³¼ì œ ì œì¶œ ì‹œìŠ¤í…œ</div>
  </a>
  <div class="user-info">
    <span th:text="${student.name + ' í•™ìƒ'}">í•™ìƒ</span>
    <span th:text="'(' + ${student.studentId} + ')'">í•™ë²ˆ</span>
    <a th:href="@{/student/main}" class="back-btn">â† ë©”ì¸ìœ¼ë¡œ</a>
    <a th:href="@{/logout}" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
  </div>
</div>

<div class="container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="page-title">ğŸ“‹ ì œì¶œ í˜„í™©</div>
    <div class="page-subtitle">ë‚˜ì˜ ê³¼ì œ ì œì¶œ í˜„í™©ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</div>
  </div>

  <!-- Statistics -->
  <div class="stats-section">
    <div class="stat-card">
      <div class="stat-number" id="totalSubmissions">0</div>
      <div class="stat-label">ì´ ì œì¶œ ê³¼ì œ</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="gradedSubmissions">0</div>
      <div class="stat-label">ì±„ì  ì™„ë£Œ</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="avgScore">0</div>
      <div class="stat-label">í‰ê·  ì ìˆ˜</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="recentSubmissions">0</div>
      <div class="stat-label">ìµœê·¼ 1ì£¼ì¼</div>
    </div>
  </div>

  <!-- Filter Section -->
  <div class="filter-section">
    <div class="filter-title">í•„í„°</div>
    <div class="filter-options">
      <button class="filter-btn active" onclick="filterSubmissions('all')">ì „ì²´</button>
      <button class="filter-btn" onclick="filterSubmissions('graded')">ì±„ì  ì™„ë£Œ</button>
      <button class="filter-btn" onclick="filterSubmissions('pending')">ì±„ì  ëŒ€ê¸°</button>
      <button class="filter-btn" onclick="filterSubmissions('recent')">ìµœê·¼ 1ì£¼ì¼</button>
    </div>
  </div>

  <!-- Submissions Section -->
  <div class="submissions-section">
    <div class="section-title">
      ğŸ“ ì œì¶œí•œ ê³¼ì œë“¤
    </div>
    <div id="loadingDiv" class="loading">
      <div class="loading-spinner"></div>
      ì œì¶œ í˜„í™©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
    </div>
    <div id="submissionsContainer" class="submissions-grid" style="display: none;">
      <!-- ì œì¶œë¬¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
    </div>
    <div id="emptyState" class="empty-state" style="display: none;">
      <div class="empty-state-icon">ğŸ“‹</div>
      <div class="empty-state-text">ì•„ì§ ì œì¶œí•œ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤</div>
      <div class="empty-state-subtext">ê³¼ì œë¥¼ ì œì¶œí•˜ë©´ ì—¬ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
    </div>
  </div>
</div>

<script>
  let allSubmissions = [];
  let currentFilter = 'all';

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì œì¶œ í˜„í™© ë¡œë“œ
  document.addEventListener('DOMContentLoaded', function() {
    loadSubmissions();
  });

  // ì œì¶œ í˜„í™© ë¡œë“œ
  function loadSubmissions() {
    document.getElementById('loadingDiv').style.display = 'block';
    document.getElementById('submissionsContainer').style.display = 'none';
    document.getElementById('emptyState').style.display = 'none';

    fetch('/api/student/submissions', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      }
    })
            .then(response => response.json())
            .then(data => {
              if (Array.isArray(data)) {
                allSubmissions = data;
                updateStatistics();
                displaySubmissions(data);
              } else if (data.success === false) {
                console.error('Error:', data.message);
                showEmptyState();
              } else {
                console.error('Invalid data format:', data);
                showEmptyState();
              }
            })
            .catch(error => {
              console.error('Error loading submissions:', error);
              showEmptyState();
            })
            .finally(() => {
              document.getElementById('loadingDiv').style.display = 'none';
            });
  }

  // í†µê³„ ì—…ë°ì´íŠ¸
  function updateStatistics() {
    const total = allSubmissions.length;
    const graded = allSubmissions.filter(s => s.score !== null && s.score !== undefined).length;
    const avgScore = graded > 0 ?
            Math.round(allSubmissions.filter(s => s.score !== null).reduce((sum, s) => sum + s.score, 0) / graded) : 0;

    const oneWeekAgo = new Date();
    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
    const recent = allSubmissions.filter(s => new Date(s.submissionTime) > oneWeekAgo).length;

    document.getElementById('totalSubmissions').textContent = total;
    document.getElementById('gradedSubmissions').textContent = graded;
    document.getElementById('avgScore').textContent = avgScore > 0 ? avgScore + 'ì ' : '-';
    document.getElementById('recentSubmissions').textContent = recent;
  }

  // ì œì¶œë¬¼ í‘œì‹œ
  function displaySubmissions(submissions) {
    const container = document.getElementById('submissionsContainer');

    if (submissions.length === 0) {
      showEmptyState();
      return;
    }

    container.innerHTML = '';
    container.style.display = 'grid';
    document.getElementById('emptyState').style.display = 'none';

    submissions.forEach(submission => {
      const submissionCard = createSubmissionCard(submission);
      container.appendChild(submissionCard);
    });
  }

  // ì œì¶œë¬¼ ì¹´ë“œ ìƒì„± (DTOìš©ìœ¼ë¡œ ìˆ˜ì •ë¨)
  function createSubmissionCard(submission) {
    const card = document.createElement('div');
    card.className = 'submission-card';
    card.onclick = () => viewAssignmentDetail(submission.assignmentCode);

    const submissionDate = new Date(submission.submissionTime);
    const lastModified = submission.lastModifiedDate ? new Date(submission.lastModifiedDate) : null;

    const scoreBadge = submission.score !== null && submission.score !== undefined
            ? `<div class="score-badge score-graded">${submission.score}ì </div>`
            : `<div class="score-badge score-pending">ì±„ì  ëŒ€ê¸°</div>`;

    // DTOì—ì„œ ì§ì ‘ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const assignmentTitle = submission.assignmentTitle || 'ê³¼ì œ ì œëª© ì—†ìŒ';
    const courseName = submission.courseName || 'ê°•ì˜ëª… ì—†ìŒ';

    card.innerHTML = `
            <div class="submission-title">${assignmentTitle}</div>
            <div class="submission-info">
                ğŸ“š <strong>${courseName}</strong>
            </div>
            <div class="submission-info">
                ğŸ“… ì œì¶œì¼: ${submissionDate.toLocaleDateString('ko-KR')} ${submissionDate.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})}
            </div>
            ${lastModified ? `<div class="submission-info">ğŸ“ ìµœì¢… ìˆ˜ì •: ${lastModified.toLocaleDateString('ko-KR')} ${lastModified.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})}</div>` : ''}
            <div class="submission-content">
                ${submission.content || 'ì œì¶œ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.'}
            </div>
            <div class="submission-footer">
                ${scoreBadge}
            </div>
            ${submission.feedback ? `<div class="submission-info" style="margin-top: 10px;">ğŸ’¬ í”¼ë“œë°±: ${submission.feedback}</div>` : ''}
        `;

    return card;
  }

  // ë¹ˆ ìƒíƒœ í‘œì‹œ
  function showEmptyState() {
    document.getElementById('submissionsContainer').style.display = 'none';
    document.getElementById('emptyState').style.display = 'block';
  }

  // í•„í„°ë§
  function filterSubmissions(filterType) {
    // í•„í„° ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    event.target.classList.add('active');

    currentFilter = filterType;
    let filteredSubmissions = allSubmissions;

    switch(filterType) {
      case 'graded':
        filteredSubmissions = allSubmissions.filter(s => s.score !== null && s.score !== undefined);
        break;
      case 'pending':
        filteredSubmissions = allSubmissions.filter(s => s.score === null || s.score === undefined);
        break;
      case 'recent':
        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
        filteredSubmissions = allSubmissions.filter(s => new Date(s.submissionTime) > oneWeekAgo);
        break;
      case 'all':
      default:
        filteredSubmissions = allSubmissions;
        break;
    }

    displaySubmissions(filteredSubmissions);
  }

  // ê³¼ì œ ìƒì„¸ë³´ê¸°ë¡œ ì´ë™
  function viewAssignmentDetail(assignmentCode) {
    window.location.href = `/student/assignment/${assignmentCode}`;
  }
</script>
</body>
</html>