<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°•ì˜ ìƒì„¸ ê´€ë¦¬ - Ploytech</title>
    <link rel="stylesheet" th:href="@{/css/professor/old/professorCourseDetailStyleSheet.css}">
</head>
<body>
<div class="header">
    <a class="header-left" th:href="@{/professor-main}" style="text-decoration: none">
        <div class="logo"></div>
        <div class="title">Ploytech ê³¼ì œ ì œì¶œ ì‹œìŠ¤í…œ</div>
    </a>
    <div class="user-info">
        <span th:text="${professor.name + ' êµìˆ˜ë‹˜'}">êµìˆ˜ë‹˜</span>
        <a th:href="@{/professor/courses}" class="back-btn">â† ê°•ì˜ ê´€ë¦¬</a>
        <a th:href="@{/professor-main}" class="main-btn">ë©”ì¸ìœ¼ë¡œ</a>
        <a th:href="@{/logout}" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
</div>

<div class="container">
    <div class="main-content">
        <!-- ì„±ê³µ/ì—ëŸ¬ ë©”ì‹œì§€ -->
        <div th:if="${successMessage}" class="success-message" th:text="${successMessage}">
            ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.
        </div>
        <div th:if="${errorMessage}" class="error-message" th:text="${errorMessage}">
            ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
        </div>
        <div th:if="${error}" class="error-message" th:text="${error}">
            ì—ëŸ¬ ë©”ì‹œì§€
        </div>

        <!-- ê°•ì˜ í—¤ë” -->
        <div class="course-header">
            <div class="course-title" th:text="${course.courseName}">ê°•ì˜ëª…</div>
            <div class="course-code" th:text="'ê°•ì˜ì½”ë“œ: ' + ${course.courseCode}">CS101</div>
            <div class="course-stats">
                <div class="course-stat">
                    <span class="course-stat-number" th:text="${#lists.size(students)}">0</span>
                    <span class="course-stat-label">ìˆ˜ê°•ìƒ</span>
                </div>
                <div class="course-stat">
                    <span class="course-stat-number" th:text="${#lists.size(assignments)}">0</span>
                    <span class="course-stat-label">ê³¼ì œ</span>
                </div>
            </div>
        </div>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('students')">
                ğŸ‘¥ ìˆ˜ê°•ìƒ ê´€ë¦¬ (<span th:text="${#lists.size(students)}">0</span>)
            </div>
            <div class="tab" onclick="switchTab('assignments')">
                ğŸ“ ê³¼ì œ ê´€ë¦¬ (<span th:text="${#lists.size(assignments)}">0</span>)
            </div>
        </div>

        <!-- ìˆ˜ê°•ìƒ ê´€ë¦¬ íƒ­ -->
        <div id="students-tab" class="tab-content active">
            <div class="section-header">
                <div class="section-title">
                    ğŸ‘¥ ìˆ˜ê°•ìƒ ëª©ë¡
                </div>
            </div>

            <div th:if="${#lists.isEmpty(students)}" class="empty-state">
                <div class="empty-state-icon">ğŸ‘¥</div>
                <div>ì•„ì§ ìˆ˜ê°•ì‹ ì²­í•œ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>

            <div th:unless="${#lists.isEmpty(students)}" class="students-grid">
                <div th:each="student : ${students}" class="student-card">
                    <div class="student-name" th:text="${student.name}">í•™ìƒ ì´ë¦„</div>
                    <div class="student-id" th:text="'í•™ë²ˆ: ' + ${student.studentId}">í•™ë²ˆ: 20230001</div>
                    <button class="btn btn-secondary btn-sm"
                            th:data-id="${student.studentId}"
                            th:data-name="${student.name}"
                            onclick="viewStudentGrades(this.dataset.id, this.dataset.name)">
                        ğŸ“Š ì„±ì  ë³´ê¸°
                    </button>

                    <button class="btn btn-danger btn-sm"
                            th:data-id="${student.studentId}"
                            th:data-name="${student.name}"
                            onclick="showRemoveStudentModal(this.dataset.id, this.dataset.name)">
                        ğŸ—‘ï¸ ì œì™¸
                    </button>
                </div>
            </div>
        </div>

        <!-- ê³¼ì œ ê´€ë¦¬ íƒ­ -->
        <div id="assignments-tab" class="tab-content">
            <div class="section-header">
                <div class="section-title">
                    ğŸ“ ê³¼ì œ ëª©ë¡
                </div>
                <a th:href="@{'/create-assignment?courseCode=' + ${course.courseCode}}" class="btn btn-primary">
                    + ìƒˆ ê³¼ì œ ë“±ë¡
                </a>
            </div>

            <div th:if="${#lists.isEmpty(assignments)}" class="empty-state">
                <div class="empty-state-icon">ğŸ“</div>
                <div>ì•„ì§ ë“±ë¡ëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                <div style="margin-top: 10px;">
                    <a th:href="@{'/create-assignment?courseCode=' + ${course.courseCode}}" class="btn btn-primary">
                        ì²« ê³¼ì œ ë“±ë¡í•˜ê¸°
                    </a>
                </div>
            </div>

            <div th:unless="${#lists.isEmpty(assignments)}" class="assignments-list">
                <div th:each="assignment : ${assignments}" class="assignment-item">
                    <div class="assignment-info">
                        <div class="assignment-title" th:text="${assignment.title}">ê³¼ì œ ì œëª©</div>
                        <div class="assignment-meta">
                            <span th:text="'ë“±ë¡ì¼: ' + ${#temporals.format(assignment.createdDate, 'yyyy-MM-dd')}">
                                ë“±ë¡ì¼: 2024-01-01
                            </span>
                            <span th:text="'ë§ˆê°ì¼: ' + ${#temporals.format(assignment.dueDate, 'yyyy-MM-dd HH:mm')}">
                                ë§ˆê°ì¼: 2024-01-15 23:59
                            </span>
                        </div>
                    </div>
                    <div class="assignment-actions">
                        <a th:href="@{'/professor/assignment/' + ${assignment.assignmentCode} + '/submissions'}"
                           class="btn btn-primary btn-sm">
                            ğŸ“Š ì œì¶œí˜„í™©
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- í•™ìƒ ì œì™¸ í™•ì¸ ëª¨ë‹¬ -->
<div id="removeStudentModal" class="modal">
    <div class="modal-content">
        <div class="modal-title">âš ï¸ ìˆ˜ê°•ìƒ ì œì™¸ í™•ì¸</div>
        <div class="modal-text">
            <strong id="studentNameToRemove"></strong> í•™ìƒì„ ì´ ê°•ì˜ì—ì„œ ì œì™¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br><br>
            <span style="color: #e74c3c; font-size: 14px;">
                âš ï¸ í•´ë‹¹ í•™ìƒì˜ ëª¨ë“  ì œì¶œë¬¼ê³¼ ì§ˆë¬¸ì´ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.
            </span>
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeRemoveStudentModal()">ì·¨ì†Œ</button>
            <form id="removeStudentForm" method="post" style="display: inline;">
                <button type="submit" class="btn btn-danger">ì œì™¸í•˜ê¸°</button>
            </form>
        </div>
    </div>
</div>

<!-- ì„±ì  ë³´ê¸° ëª¨ë‹¬ -->
<div id="gradesModal" class="modal">
    <div class="modal-content" style="width: 600px; max-height: 70vh; overflow-y: auto;">
        <div class="modal-title" style="color: #7fcdcd;">ğŸ“Š í•™ìƒ ì„±ì  í˜„í™©</div>
        <div id="gradesContent">
            <!-- ì„±ì  ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeGradesModal()">ë‹«ê¸°</button>
        </div>
    </div>
</div>

<script>
    function switchTab(tabName) {
        // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });

        // ì„ íƒëœ íƒ­ í™œì„±í™”
        event.target.classList.add('active');
        document.getElementById(tabName + '-tab').classList.add('active');
    }

    function showRemoveStudentModal(studentId, studentName) {
        document.getElementById('studentNameToRemove').textContent = studentName;
        document.getElementById('removeStudentForm').action =
            '/professor/course/' + '[[${course.courseCode}]]' + '/remove-student/' + studentId;
        document.getElementById('removeStudentModal').style.display = 'block';
    }

    function closeRemoveStudentModal() {
        document.getElementById('removeStudentModal').style.display = 'none';
    }

    function viewStudentGrades(studentId, studentName) {
        // AJAXë¡œ í•™ìƒ ì„±ì  ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        fetch('/professor/course/' + '[[${course.courseCode}]]' + '/student/' + studentId + '/grades')
            .then(response => response.json())
            .then(data => {
                let gradesHtml = '<h3 style="color: #2c3e50; margin-bottom: 20px;">' + studentName + ' ì„±ì </h3>';

                if (data.length === 0) {
                    gradesHtml += '<div style="text-align: center; padding: 20px; color: #7f8c8d;">';
                    gradesHtml += 'ì•„ì§ ì œì¶œí•œ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                } else {
                    gradesHtml += '<div style="display: grid; gap: 15px;">';
                    data.forEach(submission => {
                        gradesHtml += '<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid ' +
                            (submission.score !== null ? '#28a745' : '#ffc107') + ';">';
                        gradesHtml += '<div style="font-weight: bold; margin-bottom: 5px;">' + submission.assignmentTitle + '</div>';
                        gradesHtml += '<div style="color: #7f8c8d; font-size: 14px; margin-bottom: 10px;">ì œì¶œì¼: ' +
                            new Date(submission.submissionTime).toLocaleDateString() + '</div>';

                        if (submission.score !== null) {
                            gradesHtml += '<div style="color: #28a745; font-weight: bold;">ì ìˆ˜: ' + submission.score + 'ì </div>';
                            if (submission.feedback) {
                                gradesHtml += '<div style="margin-top: 8px; padding: 8px; background: #e8f5e8; border-radius: 4px; font-size: 14px;">';
                                gradesHtml += 'í”¼ë“œë°±: ' + submission.feedback + '</div>';
                            }
                        } else {
                            gradesHtml += '<div style="color: #ffc107; font-weight: bold;">ë¯¸ì±„ì </div>';
                        }

                        gradesHtml += '</div>';
                    });
                    gradesHtml += '</div>';
                }

                document.getElementById('gradesContent').innerHTML = gradesHtml;
                document.getElementById('gradesModal').style.display = 'block';
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ì„±ì  ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
    }

    function closeGradesModal() {
        document.getElementById('gradesModal').style.display = 'none';
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
            event.target.style.display = 'none';
        }
    }

    // ì„±ê³µ ë©”ì‹œì§€ ìë™ ìˆ¨ê¸°ê¸°
    document.addEventListener('DOMContentLoaded', function() {
        const successMessage = document.querySelector('.success-message');
        if (successMessage) {
            setTimeout(() => {
                successMessage.style.opacity = '0';
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 300);
            }, 3000);
        }
    });
</script>
</body>
</html>