<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§ˆë¬¸ ê´€ë¦¬ - Ploytech</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #a8e6cf, #7fcdcd);
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: #7fcdcd;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .logo {
            width: 60px;
            height: 60px;
            background: #ffffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .logo::before {
            content: "ğŸ’¡";
            font-size: 24px;
        }

        .title {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
            color: #2c3e50;
            font-weight: bold;
        }

        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
            text-decoration: none;
        }

        .back-btn:hover {
            background: #5a6268;
        }

        .logout-btn {
            text-decoration: none;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #c0392b;
        }

        .container {
            flex: 1;
            display: flex;
            max-width: 1200px;
            min-width: 60%;
            margin: 0 auto;
            padding: 20px;
            gap: 20px;
        }

        .sidebar {
            width: 200px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sidebar-item-container {
            text-decoration: none;
            color: inherit;
        }

        .sidebar-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
            text-decoration: none;
            color: inherit;
        }

        .sidebar-item:hover {
            transform: translateY(-2px);
        }

        .sidebar-item.active {
            background: #7fcdcd;
            color: white;
        }

        .main-content {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        .page-title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-label {
            font-weight: bold;
            color: #2c3e50;
            font-size: 14px;
            white-space: nowrap;
        }

        .filter-select {
            padding: 8px 15px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
            min-width: 120px;
        }

        .filter-select:focus {
            outline: none;
            border-color: #7fcdcd;
        }

        .filter-btn {
            background: linear-gradient(45deg, #7fcdcd, #a8e6cf);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .filter-btn:hover {
            transform: translateY(-1px);
        }

        .questions-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            min-height: 500px;
        }

        .questions-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .question-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #7fcdcd;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .question-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .question-item.answered {
            border-left-color: #28a745;
        }

        .question-item.pending {
            border-left-color: #ffc107;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .question-meta {
            flex: 1;
        }

        .course-name {
            font-size: 14px;
            color: #7fcdcd;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .assignment-title {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .student-info {
            font-size: 13px;
            color: #6c757d;
        }

        .question-date {
            font-size: 12px;
            color: #95a5a6;
            text-align: right;
            line-height: 1.3;
        }

        .question-content {
            font-size: 14px;
            color: #2c3e50;
            line-height: 1.5;
            margin: 15px 0;
            padding-left: 15px;
            border-left: 2px solid #e9ecef;
        }

        .question-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-answered {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .answer-preview {
            margin-top: 10px;
            padding: 10px 15px;
            background: #e8f5e8;
            border-radius: 6px;
            border-left: 3px solid #28a745;
            font-size: 13px;
        }

        .answer-author {
            font-size: 11px;
            color: #28a745;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .answer-text {
            color: #2c3e50;
            line-height: 1.4;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .empty-state-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .empty-state-message {
            font-size: 14px;
            line-height: 1.5;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                flex-direction: row;
                overflow-x: auto;
            }

            .sidebar-item {
                min-width: 120px;
                flex-shrink: 0;
            }

            /* í•„í„° ì „ì²´ ì»¨í…Œì´ë„ˆ */
            .filter-section {
                display: flex;
                gap: 40px;                  /* ê° í•„í„° ì‚¬ì´ ê°„ê²© */
                align-items: center;
                justify-content: flex-start;
                margin-bottom: 20px;
                flex-wrap: wrap;             /* ì¢ì„ ë• ì¤„ë°”ê¿ˆ */
                max-width: 800px;            /* ì „ì²´ ìµœëŒ€ ë„ˆë¹„ ì œí•œ */
                width: 100%;                 /* ë¶€ëª¨ ë„ˆë¹„ì— ë”°ë¼ ëŠ˜ì–´ë‚¨ */
                box-sizing: border-box;
            }

            /* ê° í•„í„° ë¬¶ìŒ */
            .filter-group {
                display: flex;
                flex: 1 1 300px;             /* ìµœì†Œ 300px í™•ë³´, ê³µê°„ì— ë”°ë¼ ëŠ˜ì–´ë‚¨ */
                align-items: center;
                gap: 10px;
                min-width: 250px;            /* ë„ˆë¬´ ì‘ì•„ì§€ì§€ ì•Šë„ë¡ ì œí•œ */
                box-sizing: border-box;
            }

            /* ë¼ë²¨ */
            .filter-label {
                flex-shrink: 0;
                font-weight: 600;
                color: #333;
            }

            /* ì…€ë ‰íŠ¸ ë°•ìŠ¤ */
            .filter-select {
                flex: 1;                     /* ë‚¨ì€ ê³µê°„ ê½‰ ì±„ì›€ */
                width: 180px;
                min-width: 180px;
                padding: 8px 12px;
                border: 1px solid #ccc;
                border-radius: 6px;
                background-color: #fff;
                font-size: 14px;
                color: #333;
                outline: none;
                transition: border-color 0.2s;
                box-sizing: border-box;
            }

            .filter-select:focus {
                border-color: #4a90e2;
            }

        }
    </style>
</head>
<body>
<div class="header">
    <div class="header-left">
        <div class="logo"></div>
        <div class="title">Ploytech ê³¼ì œ ì œì¶œ ì‹œìŠ¤í…œ</div>
    </div>
    <div class="user-info">
        <span th:text="${professor.name + ' êµìˆ˜ë‹˜'}">êµìˆ˜ë‹˜</span>
        <a th:href="@{/professor-main}" class="back-btn">â† ë©”ì¸ìœ¼ë¡œ</a>
        <a th:href="@{/logout}" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
</div>

<div class="container">
    <div class="sidebar">
        <a th:href="@{/professor-main}" class="sidebar-item-container">
            <div class="sidebar-item">ëŒ€ì‹œë³´ë“œ</div>
        </a>
        <a th:href="@{/professor/courses}" class="sidebar-item-container">
            <div class="sidebar-item">ê°•ì˜ ê´€ë¦¬</div>
        </a>
        <a th:href="@{/professor/assignments}" class="sidebar-item-container">
            <div class="sidebar-item">ê³¼ì œ ê´€ë¦¬</div>
        </a>
        <a th:href="@{/professor/questions}" class="sidebar-item-container">
            <div class="sidebar-item active">ì§ˆë¬¸ ê´€ë¦¬</div>
        </a>
    </div>

    <div class="main-content">
        <div class="page-title">ì§ˆë¬¸ ê´€ë¦¬</div>

        <!-- í•„í„° ì„¹ì…˜ -->
        <div class="filter-section">
            <div class="filter-group">
                <span class="filter-label">ê°•ì˜</span>
                <select id="courseSelect" class="filter-select" onchange="onCourseChange()">
                    <option value="">ëª¨ë‘ ë³´ê¸°</option>
                    <option th:each="course : ${courses}"
                            th:value="${course.courseCode}"
                            th:text="${course.courseName}"
                            th:selected="${selectedCourseCode == course.courseCode}">
                        ê°•ì˜ëª…
                    </option>
                </select>
            </div>

            <div class="filter-group">
                <span class="filter-label">ê³¼ì œ</span>
                <select id="assignmentSelect" class="filter-select" onchange="onAssignmentChange()">
                    <option value="">ëª¨ë‘ ë³´ê¸°</option>
                    <option th:each="assignment : ${assignments}"
                            th:value="${assignment.assignmentCode}"
                            th:text="${assignment.title}"
                            th:selected="${selectedAssignmentCode == assignment.assignmentCode.toString()}">
                        ê³¼ì œëª…
                    </option>
                </select>
            </div>

            <button type="button" class="filter-btn" onclick="applyFilter()">ê²€ìƒ‰</button>
        </div>

        <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
        <div th:if="${error}" class="error-message" th:text="${error}">
            ì—ëŸ¬ ë©”ì‹œì§€
        </div>

        <!-- ì§ˆë¬¸ ëª©ë¡ -->
        <div class="questions-container">
            <div th:if="${#lists.isEmpty(questions)}" class="empty-state">
                <div class="empty-state-icon">â“</div>
                <div class="empty-state-title">ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</div>
                <div class="empty-state-message">
                    ì„ íƒí•œ ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                    í•„í„° ì¡°ê±´ì„ ë³€ê²½í•´ë³´ì„¸ìš”.
                </div>
            </div>

            <div th:unless="${#lists.isEmpty(questions)}" class="questions-list">
                <a th:each="question : ${questions}"
                   th:href="@{'/professor/question/' + ${question.questionCode}}"
                   class="question-item"
                   th:classappend="${#lists.isEmpty(question.answers)} ? 'pending' : 'answered'">

                    <div class="question-header">
                        <div class="question-meta">
                            <div class="course-name" th:text="${question.assignment.course.courseName}">ê°•ì˜ëª…</div>
                            <div class="assignment-title" th:text="${question.assignment.title}">ê³¼ì œëª…</div>
                            <div class="student-info">
                                ì§ˆë¬¸ì: <span th:text="${question.student.name + ' (' + question.studentId + ')'}">í•™ìƒëª… (í•™ë²ˆ)</span>
                            </div>
                        </div>
                        <div class="question-date">
                            <div th:text="${#temporals.format(question.questionTime, 'yyyy-MM-dd')}">2024-01-01</div>
                            <div th:text="${#temporals.format(question.questionTime, 'HH:mm')}">12:00</div>
                        </div>
                    </div>

                    <div class="question-content" th:text="${#strings.abbreviate(question.content, 200)}">
                        ì§ˆë¬¸ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                    </div>

                    <!-- ë‹µë³€ ë¯¸ë¦¬ë³´ê¸° (ë‹µë³€ì´ ìˆëŠ” ê²½ìš°) -->
                    <div th:if="${not #lists.isEmpty(question.answers)}" class="answer-preview">
                        <div class="answer-author" th:text="${question.answers[0].professor.name + ' êµìˆ˜ë‹˜'}">êµìˆ˜ë‹˜</div>
                        <div class="answer-text" th:text="${#strings.abbreviate(question.answers[0].content, 100)}">
                            ë‹µë³€ ë¯¸ë¦¬ë³´ê¸°...
                        </div>
                    </div>

                    <div class="question-status">
                        <span th:if="${#lists.isEmpty(question.answers)}" class="status-badge status-pending">
                            ë‹µë³€ ëŒ€ê¸°
                        </span>
                        <span th:unless="${#lists.isEmpty(question.answers)}" class="status-badge status-answered">
                            ë‹µë³€ ì™„ë£Œ
                        </span>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    // ê°•ì˜ ì„ íƒ ë³€ê²½ ì‹œ ê³¼ì œ ëª©ë¡ ì—…ë°ì´íŠ¸
    function onCourseChange() {
        const courseSelect = document.getElementById('courseSelect');
        const assignmentSelect = document.getElementById('assignmentSelect');
        const selectedCourse = courseSelect.value;

        // ê³¼ì œ ì„ íƒ ì´ˆê¸°í™”
        assignmentSelect.innerHTML = '<option value="">ëª¨ë‘ ë³´ê¸°</option>';

        if (selectedCourse) {
            // AJAXë¡œ ì„ íƒëœ ê°•ì˜ì˜ ê³¼ì œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            fetch(`/professor/course/${selectedCourse}/assignments-json`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(assignments => {
                    assignments.forEach(assignment => {
                        const option = document.createElement('option');
                        option.value = assignment.assignmentCode;
                        option.textContent = assignment.title;
                        assignmentSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error fetching assignments:', error);
                });
        } else {
            // ëª¨ë“  ê°•ì˜ ì„ íƒ ì‹œ ëª¨ë“  ê³¼ì œ í‘œì‹œ
            fetch('/professor/course/all/assignments-json')
                .then(response => response.json())
                .then(assignments => {
                    assignments.forEach(assignment => {
                        const option = document.createElement('option');
                        option.value = assignment.assignmentCode;
                        option.textContent = assignment.title;
                        assignmentSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error fetching assignments:', error);
                });
        }
    }

    // ê³¼ì œ ì„ íƒ ë³€ê²½ ì‹œ
    function onAssignmentChange() {
        // í•„ìš”ì‹œ ì¶”ê°€ ë¡œì§ êµ¬í˜„
    }

    // í•„í„° ì ìš©
    function applyFilter() {
        const courseCode = document.getElementById('courseSelect').value;
        const assignmentCode = document.getElementById('assignmentSelect').value;

        let url = '/professor/questions?';
        const params = new URLSearchParams();

        if (courseCode) {
            params.append('courseCode', courseCode);
        }
        if (assignmentCode) {
            params.append('assignmentCode', assignmentCode);
        }

        window.location.href = url + params.toString();
    }

    document.addEventListener('DOMContentLoaded', function() {
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„ íƒëœ ê°•ì˜ì— ë”°ë¼ ê³¼ì œ ëª©ë¡ ì„¤ì •
        const selectedCourse = document.getElementById('courseSelect').value;
        if (selectedCourse) {
            setTimeout(() => {
                onCourseChange();
                // ì„ íƒëœ ê³¼ì œ ë³µì›
                const selectedAssignment = '[[${selectedAssignmentCode}]]';
                if (selectedAssignment && selectedAssignment !== 'null') {
                    setTimeout(() => {
                        document.getElementById('assignmentSelect').value = selectedAssignment;
                    }, 100);
                }
            }, 100);
        }
    });
</script>
</body>
</html>