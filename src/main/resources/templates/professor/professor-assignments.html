<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³¼ì œ ê´€ë¦¬ - Poly</title>
    <link rel="stylesheet" th:href="@{/css/professor/professorStyleSheet.css}">
    <link rel="stylesheet" th:href="@{/css/professor/professorAssignmentsStyleSheet.css}">
</head>
<body>
<div class="header">
    <a class="header-left" th:href="@{/professor-main}" style="text-decoration: none">
        <div class="logo"></div>
        <div class="title">AISW</div>
    </a>
    <div class="user-info">
        <span th:text="${professor.name + ' êµìˆ˜ë‹˜'}">êµìˆ˜ë‹˜</span>
        <a th:href="@{/professor-main}" class="back-btn">â† ë©”ì¸ìœ¼ë¡œ</a>
        <a th:href="@{/logout}" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
</div>

<div class="container">
    <div class="sidebar">
        <a th:href="@{/professor-main}" class="sidebar-item-container">
            <div class="sidebar-item">ëŒ€ì‹œë³´ë“œ</div>
        </a>
        <a th:href="@{/professor/courses}" class="sidebar-item-container">
            <div class="sidebar-item">ê°•ì˜ ê´€ë¦¬</div>
        </a>
        <a th:href="@{/professor/assignments}" class="sidebar-item-container">
            <div class="sidebar-item active">ê³¼ì œ ê´€ë¦¬</div>
        </a>
        <a th:href="@{/professor/questions}" class="sidebar-item-container">
            <div class="sidebar-item">ì§ˆë¬¸ ê´€ë¦¬</div>
        </a>
    </div>

    <div class="main-content">
        <div class="page-header">
            <div class="page-title">ğŸ“‹ ê³¼ì œ ê´€ë¦¬</div>
            <div class="page-subtitle">ê³¼ì œë³„ ì œì¶œ í˜„í™©ì„ í™•ì¸í•˜ê³  ì±„ì í•˜ì„¸ìš”</div>
        </div>

        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <div class="button-container">
            <h3>ìƒˆë¡œìš´ ê³¼ì œë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!</h3>
            <a th:href="@{/create-assignment}" class="btn-primary" style="display: block;">ê³¼ì œ ë“±ë¡í•˜ê¸°</a>
        </div>

        <!-- Search Section -->
        <div class="search-section" style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                <input type="text"
                       id="searchInput"
                       placeholder="ğŸ” ê³¼ì œ ì œëª© ë˜ëŠ” ê°•ì˜ëª…ìœ¼ë¡œ ê²€ìƒ‰..."
                       style="flex: 1; min-width: 250px; padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px;"
                       onkeyup="searchAssignments()">
                <select id="courseFilter"
                        onchange="searchAssignments()"
                        style="padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; min-width: 200px;">
                    <option value="">ëª¨ë“  ê°•ì˜</option>
                </select>
                <button onclick="resetSearch()"
                        style="padding: 12px 20px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: background 0.3s;"
                        onmouseover="this.style.background='#5a6268'"
                        onmouseout="this.style.background='#6c757d'">
                    ì´ˆê¸°í™”
                </button>
            </div>
            <div id="searchResultInfo" style="margin-top: 10px; color: #7f8c8d; font-size: 14px;">
                <!-- ê²€ìƒ‰ ê²°ê³¼ ì •ë³´ -->
            </div>
        </div>

        <div th:if="${#lists.isEmpty(assignments)}" class="empty-state">
            <div class="empty-state-icon">ğŸ“</div>
            <h3>ë“±ë¡ëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>ìƒˆë¡œìš´ ê³¼ì œë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!</p>
            <a th:href="@{/create-assignment}" class="btn-primary">ê³¼ì œ ë“±ë¡í•˜ê¸°</a>
        </div>

        <div th:unless="${#lists.isEmpty(assignments)}" class="assignments-grid" id="assignmentsGrid">
            <a style="text-decoration: none;"
               th:each="assignment : ${assignments}"
               th:href="@{'/professor/assignment/' + ${assignment.assignmentCode} + '/submissions'}"
               class="assignment-card-link"
               th:data-title="${assignment.title}"
               th:data-course="${assignment.course.courseName}"
               th:data-course-code="${assignment.course.courseCode}">
                <div class="assignment-card">
                    <div class="assignment-header">
                        <h3 class="assignment-title" th:text="${assignment.title}">ê³¼ì œ ì œëª©</h3>
                        <span class="assignment-code" th:text="${'#' + assignment.assignmentCode}">#001</span>
                    </div>

                    <div class="course-info">
                        <span>ğŸ“š</span>
                        <span th:text="${assignment.course.courseName + ' (' + assignment.course.courseCode + ')'}">ê°•ì˜ëª… (ì½”ë“œ)</span>
                    </div>

                    <div class="assignment-dates">
                        <div class="date-item">
                            <span>ğŸ“…</span>
                            <span th:text="'ë“±ë¡: ' + ${#temporals.format(assignment.createdDate, 'MM-dd HH:mm')}">ë“±ë¡ì¼</span>
                        </div>
                        <div class="date-item">
                            <span>â°</span>
                            <span th:text="'ë§ˆê°: ' + ${#temporals.format(assignment.dueDate, 'MM-dd HH:mm')}">ë§ˆê°ì¼</span>
                        </div>
                    </div>

                    <div class="stats-section">
                        <div class="stat-item">
                            <div class="stat-number" th:text="${#lists.size(assignment.submissions) ?: '0'}">0</div>
                            <div class="stat-label">ì œì¶œë¬¼</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" th:text="${assignment.submissions != null ? #lists.size(assignment.submissions.?[score != null]) : '0'}">0</div>
                            <div class="stat-label">ì±„ì ì™„ë£Œ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" th:text="${#lists.size(assignment.questions) ?: '0'}">0</div>
                            <div class="stat-label">ì§ˆë¬¸</div>
                        </div>
                    </div>

                    <div class="action-buttons" onclick="event.stopPropagation();">
                        <a th:href="@{'/professor/assignment/' + ${assignment.assignmentCode} + '/submissions'}" class="btn-primary">
                            ğŸ“‹ ì œì¶œë¬¼ ë³´ê¸°
                        </a>
                        <a th:href="@{'/professor/assignment/' + ${assignment.assignmentCode} + '/edit'}" class="btn-secondary">
                            âœï¸ ìˆ˜ì •
                        </a>
                        <a th:href="@{'/professor/assignment/' + ${assignment.assignmentCode} + '/questions'}" class="btn-secondary">
                            â“ ì§ˆë¬¸ ë³´ê¸°
                        </a>

                        <form th:action="@{/professor/assignment/{code}/delete(code=${assignment.assignmentCode})}"
                              method="post"
                              onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');"
                              style="display:inline;">
                            <button type="submit" class="btn-danger">
                                ğŸ—‘ï¸ ê³¼ì œ ì‚­ì œ
                            </button>
                        </form>
                    </div>
                </div>
            </a>
        </div>

        <div id="noResults" class="empty-state" style="display: none;">
            <div class="empty-state-icon">ğŸ”</div>
            <h3>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”.</p>
        </div>
    </div>
</div>

<script>
    let allAssignmentCards = [];
    let allCourses = new Set();

    document.addEventListener('DOMContentLoaded', function() {
        // ëª¨ë“  ê³¼ì œ ì¹´ë“œ ì €ì¥
        allAssignmentCards = Array.from(document.querySelectorAll('.assignment-card-link'));

        // ê°•ì˜ í•„í„° ì˜µì…˜ ìƒì„±
        allAssignmentCards.forEach(card => {
            const courseCode = card.dataset.courseCode;
            const courseName = card.dataset.course;
            if (courseCode && courseName) {
                allCourses.add(JSON.stringify({code: courseCode, name: courseName}));
            }
        });

        const courseFilter = document.getElementById('courseFilter');
        Array.from(allCourses).sort().forEach(courseStr => {
            const course = JSON.parse(courseStr);
            const option = document.createElement('option');
            option.value = course.code;
            option.textContent = `${course.name} (${course.code})`;
            courseFilter.appendChild(option);
        });

        updateSearchInfo();
    });

    function searchAssignments() {
        const searchText = document.getElementById('searchInput').value.toLowerCase().trim();
        const selectedCourse = document.getElementById('courseFilter').value;

        let visibleCount = 0;

        allAssignmentCards.forEach(card => {
            const title = card.dataset.title.toLowerCase();
            const course = card.dataset.course.toLowerCase();
            const courseCode = card.dataset.courseCode;

            const matchesSearch = !searchText || title.includes(searchText) || course.includes(searchText);
            const matchesCourse = !selectedCourse || courseCode === selectedCourse;

            if (matchesSearch && matchesCourse) {
                card.style.display = 'block';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });

        // ê²€ìƒ‰ ê²°ê³¼ ì •ë³´ ì—…ë°ì´íŠ¸
        updateSearchInfo(visibleCount, searchText, selectedCourse);

        // ê²°ê³¼ ì—†ìŒ ë©”ì‹œì§€ í‘œì‹œ
        const noResults = document.getElementById('noResults');
        const assignmentsGrid = document.getElementById('assignmentsGrid');

        if (visibleCount === 0 && allAssignmentCards.length > 0) {
            if (assignmentsGrid) assignmentsGrid.style.display = 'none';
            if (noResults) noResults.style.display = 'block';
        } else {
            if (assignmentsGrid) assignmentsGrid.style.display = 'grid';
            if (noResults) noResults.style.display = 'none';
        }
    }

    function updateSearchInfo(visibleCount, searchText, selectedCourse) {
        const info = document.getElementById('searchResultInfo');
        if (!info) return;

        if (visibleCount === undefined) {
            visibleCount = allAssignmentCards.length;
        }

        let infoText = `ì´ ${allAssignmentCards.length}ê°œ ì¤‘ ${visibleCount}ê°œ í‘œì‹œ`;

        if (searchText || selectedCourse) {
            infoText += ' | í•„í„°: ';
            const filters = [];
            if (searchText) filters.push(`ê²€ìƒ‰ì–´ "${searchText}"`);
            if (selectedCourse) {
                const courseFilter = document.getElementById('courseFilter');
                const selectedOption = courseFilter.options[courseFilter.selectedIndex];
                filters.push(`ê°•ì˜ "${selectedOption.textContent}"`);
            }
            infoText += filters.join(', ');
        }

        info.textContent = infoText;
    }

    function resetSearch() {
        document.getElementById('searchInput').value = '';
        document.getElementById('courseFilter').value = '';
        searchAssignments();
    }
</script>
</body>
</html>