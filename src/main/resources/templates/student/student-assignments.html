<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³¼ì œ ëª©ë¡ - Ploytech</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #a8e6cf, #7fcdcd);
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: #7fcdcd;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .logo {
            width: 60px;
            height: 60px;
            background: #ffffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .logo::before {
            content: "ğŸ’¡";
            font-size: 24px;
        }

        .title {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
            color: #2c3e50;
            font-weight: bold;
        }

        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
            text-decoration: none;
        }

        .back-btn:hover {
            background: #5a6268;
        }

        /*.container {*/
        /*    flex: 1;*/
        /*    max-width: 1200px;*/
        /*    margin: 0 auto;*/
        /*    padding: 20px;*/
        /*}*/

        .container {
            flex: 1;
            max-width: 1200px;
            /*margin: 0 auto;*/
            padding: 20px 400px;
        }

        .page-header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .page-title {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .page-subtitle {
            font-size: 18px;
            color: #7f8c8d;
        }

        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            font-weight: bold;
            color: #2c3e50;
        }

        .filter-select {
            padding: 8px 12px;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        .filter-select:focus {
            outline: none;
            border-color: #7fcdcd;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #7fcdcd;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 5px;
        }

        .assignments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .assignment-card {
            text-decoration: none;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            position: relative;
        }

        .assignment-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .assignment-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .assignment-title {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
            line-height: 1.3;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
        }

        .status-submitted {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-overdue {
            background: #f8d7da;
            color: #721c24;
        }

        .course-info {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .assignment-dates {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin: 15px 0;
        }

        .date-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #5a6c7d;
        }

        .date-icon {
            font-size: 16px;
        }

        .assignment-description {
            color: #5a6c7d;
            font-size: 14px;
            line-height: 1.4;
            margin: 15px 0;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .time-remaining {
            font-size: 12px;
            font-weight: bold;
            margin-top: 15px;
            padding: 8px 12px;
            border-radius: 6px;
            text-align: center;
        }

        .time-normal {
            background: #d4edda;
            color: #155724;
        }

        .time-warning {
            background: #fff3cd;
            color: #856404;
        }

        .time-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .empty-state p {
            font-size: 16px;
            margin-bottom: 20px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #7fcdcd, #a8e6cf);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: transform 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #7f8c8d;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e1e8ed;
            border-top: 4px solid #7fcdcd;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group {
                justify-content: space-between;
            }

            .assignments-grid {
                grid-template-columns: 1fr;
            }

            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
<div class="header">
    <div class="header-left">
        <div class="logo"></div>
        <div class="title">Ploytech ê³¼ì œ ì œì¶œ ì‹œìŠ¤í…œ</div>
    </div>
    <div class="user-info">
        <span th:text="${student.name + ' í•™ìƒ'}">í•™ìƒ</span>
        <span th:text="'(' + ${student.studentId} + ')'">í•™ë²ˆ</span>
        <a th:href="@{/student/main}" class="back-btn">â† ë©”ì¸ìœ¼ë¡œ</a>
    </div>
</div>

<div class="container">
    <!-- Page Header -->
    <div class="page-header">
        <div class="page-title">ğŸ“ ê³¼ì œ ëª©ë¡</div>
        <div class="page-subtitle">ë‚´ ê³¼ì œë¥¼ í•œëˆˆì— í™•ì¸í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</div>
    </div>

    <!-- Error Message -->
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <!-- Statistics Cards -->
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-number" th:text="${#lists.size(assignments)}">0</div>
            <div class="stat-label">ì „ì²´ ê³¼ì œ</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="submittedCount">0</div>
            <div class="stat-label">ì œì¶œ ì™„ë£Œ</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="pendingCount">0</div>
            <div class="stat-label">ë¯¸ì œì¶œ</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="overdueCount">0</div>
            <div class="stat-label">ê¸°í•œ ì´ˆê³¼</div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
        <div class="filter-group">
            <label for="statusFilter">ìƒíƒœ:</label>
            <select id="statusFilter" class="filter-select" onchange="filterAssignments()">
                <option value="all">ì „ì²´</option>
                <option value="pending">ë¯¸ì œì¶œ</option>
                <option value="submitted">ì œì¶œì™„ë£Œ</option>
                <option value="overdue">ê¸°í•œì´ˆê³¼</option>
            </select>
        </div>
        <div class="filter-group">
            <label for="courseFilter">ê°•ì˜:</label>
            <select id="courseFilter" class="filter-select" onchange="filterAssignments()">
                <option value="all">ì „ì²´ ê°•ì˜</option>
            </select>
        </div>
        <div class="filter-group">
            <label for="sortFilter">ì •ë ¬:</label>
            <select id="sortFilter" class="filter-select" onchange="sortAssignments()">
                <option value="dueDate">ë§ˆê°ì¼ìˆœ</option>
                <option value="createdDate">ìƒì„±ì¼ìˆœ</option>
                <option value="title">ì œëª©ìˆœ</option>
            </select>
        </div>
    </div>

    <!-- Assignments Grid -->
    <div id="assignmentsContainer">
        <div th:if="${#lists.isEmpty(assignments)}" class="empty-state">
            <div class="empty-state-icon">ğŸ“</div>
            <h3>ì•„ì§ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>ìˆ˜ì—…ì„ ë“±ë¡í•˜ë©´ ê³¼ì œë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”!</p>
            <a th:href="@{/student/main}" class="btn-primary">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>

        <div th:unless="${#lists.isEmpty(assignments)}" class="assignments-grid" id="assignmentsGrid">
            <a th:each="assignment : ${assignments}"
                 class="assignment-card"
               th:href="@{/student/assignment/{code}(code=${assignment.assignmentCode})}"
               th:data-status="${assignment.isSubmitted() ? 'submitted' : (assignment.isOverdue() ? 'overdue' : 'pending')}"
               th:data-course="${assignment.course.courseCode}"
               th:data-due-date="${assignment.dueDate}"
               th:data-created-date="${assignment.createdDate}"
               th:data-title="${assignment.title}">

                <div class="assignment-header">
                    <h3 class="assignment-title" th:text="${assignment.title}">ê³¼ì œ ì œëª©</h3>
                    <span class="status-badge"
                          th:class="${'status-badge ' + (assignment.isSubmitted() ? 'status-submitted' : (assignment.isOverdue() ? 'status-overdue' : 'status-pending'))}"
                          th:text="${assignment.isSubmitted() ? 'ì œì¶œì™„ë£Œ' : (assignment.isOverdue() ? 'ê¸°í•œì´ˆê³¼' : 'ë¯¸ì œì¶œ')}">ìƒíƒœ</span>
                </div>

                <div class="course-info">
                    <span>ğŸ“š</span>
                    <span th:text="${assignment.course.courseName}">ê°•ì˜ëª…</span>
                    <span th:text="'(' + ${assignment.course.courseCode} + ')'">ê°•ì˜ì½”ë“œ</span>
                </div>

                <div class="assignment-description" th:text="${assignment.content}">
                    ê³¼ì œ ì„¤ëª…...
                </div>

                <div class="assignment-dates">
                    <div class="date-item">
                        <span class="date-icon">ğŸ“…</span>
                        <span th:text="'ìƒì„±: ' + ${#temporals.format(assignment.createdDate, 'yyyy-MM-dd HH:mm')}">ìƒì„±ì¼</span>
                    </div>
                    <div class="date-item">
                        <span class="date-icon">â°</span>
                        <span th:text="'ë§ˆê°: ' + ${#temporals.format(assignment.dueDate, 'yyyy-MM-dd HH:mm')}">ë§ˆê°ì¼</span>
                    </div>
                </div>

                <div class="time-remaining"
                     th:data-due-date="${assignment.dueDate}"
                     th:data-is-submitted="${assignment.isSubmitted()}">
                    ì‹œê°„ ê³„ì‚° ì¤‘...
                </div>
            </a>
        </div>
    </div>
</div>

<script>
    let allAssignments = [];

    document.addEventListener('DOMContentLoaded', function() {
        // ê³¼ì œ ë°ì´í„° ì €ì¥
        const assignmentCards = document.querySelectorAll('.assignment-card');
        allAssignments = Array.from(assignmentCards).map(card => ({
            element: card,
            status: card.dataset.status,
            course: card.dataset.course,
            dueDate: new Date(card.dataset.dueDate),
            createdDate: new Date(card.dataset.createdDate),
            title: card.dataset.title
        }));

        // ê°•ì˜ í•„í„° ì˜µì…˜ ì„¤ì •
        setupCourseFilter();

        // í†µê³„ ì—…ë°ì´íŠ¸
        updateStatistics();

        // ë‚¨ì€ ì‹œê°„ ì—…ë°ì´íŠ¸
        updateTimeRemaining();

        // 1ë¶„ë§ˆë‹¤ ì‹œê°„ ì—…ë°ì´íŠ¸
        setInterval(updateTimeRemaining, 60000);
    });

    function setupCourseFilter() {
        const courseFilter = document.getElementById('courseFilter');
        const courses = new Set();

        allAssignments.forEach(assignment => {
            courses.add(assignment.course);
        });

        courses.forEach(course => {
            const option = document.createElement('option');
            option.value = course;
            option.textContent = course;
            courseFilter.appendChild(option);
        });
    }

    function updateStatistics() {
        const submitted = allAssignments.filter(a => a.status === 'submitted').length;
        const pending = allAssignments.filter(a => a.status === 'pending').length;
        const overdue = allAssignments.filter(a => a.status === 'overdue').length;

        document.getElementById('submittedCount').textContent = submitted;
        document.getElementById('pendingCount').textContent = pending;
        document.getElementById('overdueCount').textContent = overdue;
    }

    function filterAssignments() {
        const statusFilter = document.getElementById('statusFilter').value;
        const courseFilter = document.getElementById('courseFilter').value;

        allAssignments.forEach(assignment => {
            let show = true;

            // ìƒíƒœ í•„í„°
            if (statusFilter !== 'all' && assignment.status !== statusFilter) {
                show = false;
            }

            // ê°•ì˜ í•„í„°
            if (courseFilter !== 'all' && assignment.course !== courseFilter) {
                show = false;
            }

            assignment.element.style.display = show ? 'block' : 'none';
        });
    }

    function sortAssignments() {
        const sortBy = document.getElementById('sortFilter').value;
        const container = document.getElementById('assignmentsGrid');

        const sortedAssignments = [...allAssignments].sort((a, b) => {
            switch (sortBy) {
                case 'dueDate':
                    return a.dueDate - b.dueDate;
                case 'createdDate':
                    return b.createdDate - a.createdDate;
                case 'title':
                    return a.title.localeCompare(b.title);
                default:
                    return 0;
            }
        });

        // DOM ì¬ì •ë ¬
        sortedAssignments.forEach(assignment => {
            container.appendChild(assignment.element);
        });
    }

    function updateTimeRemaining() {
        const timeElements = document.querySelectorAll('.time-remaining');
        const now = new Date();

        timeElements.forEach(element => {
            const dueDate = new Date(element.dataset.dueDate);
            const isSubmitted = element.dataset.isSubmitted === 'true';
            const timeDiff = dueDate - now;

            if (isSubmitted) {
                element.textContent = 'âœ… ì œì¶œì™„ë£Œ';
                element.className = 'time-remaining time-normal';
            } else if (timeDiff <= 0) {
                element.textContent = 'âš ï¸ ê¸°í•œë§Œë£Œ';
                element.className = 'time-remaining time-danger';
            } else {
                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));

                let timeText = '';
                if (days > 0) {
                    timeText = `${days}ì¼ ${hours}ì‹œê°„ ë‚¨ìŒ`;
                } else if (hours > 0) {
                    timeText = `${hours}ì‹œê°„ ${minutes}ë¶„ ë‚¨ìŒ`;
                } else {
                    timeText = `${minutes}ë¶„ ë‚¨ìŒ`;
                }

                element.textContent = `â° ${timeText}`;

                // ì‹œê°„ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                if (timeDiff < 24 * 60 * 60 * 1000) { // 24ì‹œê°„ ë¯¸ë§Œ
                    element.className = 'time-remaining time-danger';
                } else if (timeDiff < 72 * 60 * 60 * 1000) { // 72ì‹œê°„ ë¯¸ë§Œ
                    element.className = 'time-remaining time-warning';
                } else {
                    element.className = 'time-remaining time-normal';
                }
            }
        });
    }

    function viewAssignment(assignmentCode) {
        window.location.href = `/student/assignment/${assignmentCode}`;
    }
</script>
</body>
</html>