<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>과제 제출물 관리 - Poly</title>
  <link rel="stylesheet" th:href="@{/css/professor/professorStyleSheet.css}">
  <link rel="stylesheet" th:href="@{/css/professor/professorSubmissionsStyleSheet.css}">
</head>
<body>
<div class="header">
  <a class="header-left" th:href="@{/professor-main}" style="text-decoration: none">
    <div class="logo"></div>
    <div class="title">Poly</div>
  </a>
  <div class="user-info">
    <span th:text="${professor.name + ' 교수님'}">교수님</span>
    <a th:href="@{/professor/assignments}" class="back-btn">← 과제 목록</a>
  </div>
</div>

<div class="main-content" style="max-width: 1200px; width: 100%; margin: 0 auto;">
  <!-- Success/Error Messages -->
  <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
  <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

  <!-- Assignment Info -->
  <div class="assignment-info">
    <div class="assignment-title" th:text="${assignment.title}">과제 제목</div>
    <div class="assignment-meta">
      <div class="meta-item">
        <span>📚</span>
        <span th:text="${assignment.course.courseName}">강의명</span>
      </div>
      <div class="meta-item">
        <span>📅</span>
        <span th:text="'등록일: ' + ${#temporals.format(assignment.createdDate, 'yyyy-MM-dd HH:mm')}">등록일</span>
      </div>
      <div class="meta-item">
        <span>⏰</span>
        <span th:text="'마감일: ' + ${#temporals.format(assignment.dueDate, 'yyyy-MM-dd HH:mm')}">마감일</span>
      </div>
    </div>
    <div class="assignment-description" th:text="${assignment.content}">과제 설명</div>
  </div>

  <!-- Statistics -->
  <div class="stats-cards">
    <div class="stat-card">
      <div class="stat-number" th:text="${#lists.size(submissions)}">0</div>
      <div class="stat-label">총 제출물</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" th:text="${submissions != null ? #lists.size(submissions.?[score != null]) : '0'}">0</div>
      <div class="stat-label">채점 완료</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" th:text="${submissions != null ? #lists.size(submissions.?[score == null]) : '0'}">0</div>
      <div class="stat-label">채점 대기</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" th:text="${submissions != null and !#lists.isEmpty(submissions.?[score != null]) ? (#numbers.formatDecimal((#aggregates.sum(submissions.?[score != null].![score]) / #lists.size(submissions.?[score != null])), 1, 1)) : '0.0'}">0.0</div>
      <div class="stat-label">평균 점수</div>
    </div>
  </div>

  <!-- Submissions Table -->
  <div class="submissions-table">
    <div class="table-header">
      <div class="table-title">제출물 목록</div>
    </div>

    <div th:if="${#lists.isEmpty(submissions)}" class="empty-state">
      <div class="empty-state-icon">📋</div>
      <h3>제출된 과제가 없습니다</h3>
      <p>아직 학생들이 과제를 제출하지 않았습니다.</p>
    </div>

    <table th:unless="${#lists.isEmpty(submissions)}">
      <thead>
      <tr>
        <th>학생</th>
        <th>제출일시</th>
        <th>상태</th>
        <th>점수</th>
        <th>관리</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="submission : ${submissions}" th:onclick="'location.href=\'/professor/submission/' + ${submission.submissionCode} + '\''" style="cursor: pointer;">
        <td>
          <div class="student-info">
            <div class="student-avatar" th:text="${submission.student.name.substring(0,1)}">학</div>
            <div class="student-details">
              <div class="student-name" th:text="${submission.student.name}">학생명</div>
              <div class="student-id" th:text="${submission.student.studentId}">학번</div>
            </div>
          </div>
        </td>
        <td th:text="${#temporals.format(submission.submissionTime, 'yyyy-MM-dd HH:mm')}">제출일시</td>
        <td>
          <span th:if="${submission.score != null}" class="submission-status status-graded">채점완료</span>
          <span th:if="${submission.score == null and submission.submissionTime.isBefore(assignment.dueDate)}"
                class="submission-status status-submitted">제출완료</span>
          <span th:if="${submission.score == null and submission.submissionTime.isAfter(assignment.dueDate)}"
                class="submission-status status-late">지각제출</span>
        </td>
        <td>
                        <span th:if="${submission.score != null}"
                              th:class="${'score-display ' + (submission.score >= 90 ? 'score-good' : (submission.score >= 70 ? 'score-average' : 'score-poor'))}"
                              th:text="${submission.score + '점'}">점수</span>
          <span th:if="${submission.score == null}" class="submission-status" style="background: #e9ecef; color: #6c757d;">미채점</span>
        </td>
        <td>
          <a th:href="@{'/professor/submission/' + ${submission.submissionCode}}" class="action-btn">
            📝 채점하기
          </a>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
</body>
</html>