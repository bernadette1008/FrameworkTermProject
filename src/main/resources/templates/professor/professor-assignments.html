<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>과제 관리 - Poly</title>
    <link rel="stylesheet" th:href="@{/css/professor/professorStyleSheet.css}">
    <link rel="stylesheet" th:href="@{/css/professor/professorAssignmentsStyleSheet.css}">
<!--    <link rel="stylesheet" th:href="@{/css/professor/old/professorAssignmentsStyleSheet.css}">-->
</head>
<body>
<div class="header">
    <a class="header-left" th:href="@{/professor-main}" style="text-decoration: none">
        <div class="logo"></div>
        <div class="title">Poly</div>
    </a>
    <div class="user-info">
        <span th:text="${professor.name + ' 교수님'}">교수님</span>
        <a th:href="@{/professor-main}" class="back-btn">← 메인으로</a>
        <a th:href="@{/logout}" class="logout-btn">로그아웃</a>
    </div>
</div>

<div class="container">
    <div class="sidebar">
        <a th:href="@{/professor-main}" class="sidebar-item-container">
            <div class="sidebar-item">대시보드</div>
        </a>
        <a th:href="@{/professor/courses}" class="sidebar-item-container">
            <div class="sidebar-item">강의 관리</div>
        </a>
        <a th:href="@{/professor/assignments}" class="sidebar-item-container">
            <div class="sidebar-item active">과제 관리</div>
        </a>
        <a th:href="@{/professor/questions}" class="sidebar-item-container">
            <div class="sidebar-item">질문 관리</div>
        </a>
    </div>

    <!-- Page Header -->
    <div class="main-content">
        <div class="page-header">
            <div class="page-title">📋 과제 관리</div>
            <div class="page-subtitle">과제별 제출 현황을 확인하고 채점하세요</div>
        </div>
        <!-- Error Message -->
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <div class="button-container">
            <h3>새로운 과제를 등록해보세요!</h3>
            <a th:href="@{/create-assignment}" class="btn-primary" style="display: block;">과제 등록하기</a>
        </div>

        <!-- Assignments Grid -->
        <div th:if="${#lists.isEmpty(assignments)}" class="empty-state">
            <div class="empty-state-icon">📝</div>
            <h3>등록된 과제가 없습니다</h3>
            <p>새로운 과제를 등록해보세요!</p>
            <a th:href="@{/create-assignment}" class="btn-primary">과제 등록하기</a>
        </div>

        <div th:unless="${#lists.isEmpty(assignments)}" class="assignments-grid">
            <a style="text-decoration: none;" th:each="assignment : ${assignments}" th:href="@{'/professor/assignment/' + ${assignment.assignmentCode} + '/submissions'}">
                <div class="assignment-card">

                    <div class="assignment-header">
                        <h3 class="assignment-title" th:text="${assignment.title}">과제 제목</h3>
                        <span class="assignment-code" th:text="${'#' + assignment.assignmentCode}">#001</span>
                    </div>

                    <div class="course-info">
                        <span>📚</span>
                        <span th:text="${assignment.course.courseName + ' (' + assignment.course.courseCode + ')'}">강의명 (코드)</span>
                    </div>

                    <div class="assignment-dates">
                        <div class="date-item">
                            <span>📅</span>
                            <span th:text="'등록: ' + ${#temporals.format(assignment.createdDate, 'MM-dd HH:mm')}">등록일</span>
                        </div>
                        <div class="date-item">
                            <span>⏰</span>
                            <span th:text="'마감: ' + ${#temporals.format(assignment.dueDate, 'MM-dd HH:mm')}">마감일</span>
                        </div>
                    </div>

                    <div class="stats-section">
                        <div class="stat-item">
                            <div class="stat-number" th:text="${#lists.size(assignment.submissions) ?: '0'}">0</div>
                            <div class="stat-label">제출물</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" th:text="${assignment.submissions != null ? #lists.size(assignment.submissions.?[score != null]) : '0'}">0</div>
                            <div class="stat-label">채점완료</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" th:text="${#lists.size(assignment.questions) ?: '0'}">0</div>
                            <div class="stat-label">질문</div>
                        </div>
                    </div>

                    <div class="action-buttons" onclick="event.stopPropagation();">
                        <a th:href="@{'/professor/assignment/' + ${assignment.assignmentCode} + '/submissions'}" class="btn-primary">
                            📋 제출물 보기
                        </a>
                        <a th:href="@{'/professor/assignment/' + ${assignment.assignmentCode} + '/edit'}" class="btn-secondary">
                            ✏️ 수정
                        </a>
                        <a th:href="@{'/professor/assignment/' + ${assignment.assignmentCode} + '/questions'}" class="btn-secondary">
                            ❓ 질문 보기
                        </a>

                        <form th:action="@{/professor/assignment/{code}/delete(code=${assignment.assignmentCode})}"
                              method="post"
                              onsubmit="return confirm('정말 삭제하시겠습니까?');"
                              style="display:inline;">
                            <button type="submit" class="btn-danger">
                                🗑️ 과제 삭제
                            </button>
                        </form>
                    </div>
                </div>
            </a>

        </div>
    </div>
</div>
</body>
</html>
