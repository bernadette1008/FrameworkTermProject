<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>과제별 질문 관리 - Poly</title>
    <link rel="stylesheet" th:href="@{/css/professor/professorStyleSheet.css}">
    <link rel="stylesheet" th:href="@{/css/professor/professorAssignmentQuestionsStyleSheet.css}">
</head>
<body>
<div class="header">
    <a class="header-left" th:href="@{/professor-main}" style="text-decoration: none">
        <div class="logo"></div>
        <div class="title">AISW</div>
    </a>
    <div class="user-info">
        <span th:text="${professor.name + ' 교수님'}">교수님</span>
        <a th:href="@{/professor-main}" class="back-btn">← 메인으로</a>
        <a th:href="@{/logout}" class="logout-btn">로그아웃</a>
    </div>
</div>

<div class="container">
    <div class="main-content">
        <div class="navigation-links">
            <a th:href="@{'/professor/assignment/' + ${assignment.assignmentCode} + '/submissions'}" class="nav-btn primary">
                📋 제출물 보기
            </a>
            <a th:href="@{/professor/assignments}" class="nav-btn">← 과제 목록</a>
            <a th:href="@{/professor/questions}" class="nav-btn">전체 질문 보기</a>
        </div>

        <!-- 과제 정보 헤더 -->
        <div class="page-header">
            <div class="assignment-info">
                <div class="assignment-title" th:text="${assignment.title}">과제명</div>
                <div class="course-name" th:text="${assignment.course.courseName + ' (' + assignment.course.courseCode + ')'}">강의명 (코드)</div>
            </div>

            <div class="assignment-meta">
                <div class="assignment-dates">
                    <div class="date-item">
                        <span>📅</span>
                        <span th:text="'등록: ' + ${#temporals.format(assignment.createdDate, 'yyyy-MM-dd HH:mm')}">등록일</span>
                    </div>
                    <div class="date-item">
                        <span>⏰</span>
                        <span th:text="'마감: ' + ${#temporals.format(assignment.dueDate, 'yyyy-MM-dd HH:mm')}">마감일</span>
                    </div>
                </div>

                <div class="question-stats">
                    <div class="stat-item">
                        <div class="stat-number" th:text="${#lists.size(questions)}">0</div>
                        <div class="stat-label">전체 질문</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" th:text="${questions != null ? #lists.size(questions.?[answers != null and #lists.size(answers) > 0]) : '0'}">0</div>
                        <div class="stat-label">답변 완료</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" th:text="${questions != null ? #lists.size(questions.?[answers == null or #lists.size(answers) == 0]) : '0'}">0</div>
                        <div class="stat-label">답변 대기</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 필터 섹션 -->
        <div class="filter-section">
            <div class="filter-title">질문 필터</div>
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterQuestions('all')">전체</button>
                <button class="filter-btn" onclick="filterQuestions('answered')">답변 완료</button>
                <button class="filter-btn" onclick="filterQuestions('pending')">답변 대기</button>
            </div>
        </div>

        <!-- 에러 메시지 -->
        <div th:if="${error}" class="error-message" th:text="${error}">
            에러 메시지
        </div>

        <!-- 질문 목록 -->
        <div th:if="${#lists.isEmpty(questions)}" class="empty-state">
            <div class="empty-state-icon">❓</div>
            <div class="empty-state-title">이 과제에 대한 질문이 없습니다</div>
            <div class="empty-state-message">
                학생들이 과제에 대해 질문을 남기면<br>
                이곳에서 확인하고 답변할 수 있습니다.
            </div>
        </div>

        <div th:unless="${#lists.isEmpty(questions)}" class="questions-list">
            <a th:each="question : ${questions}"
               th:href="@{'/professor/question/' + ${question.questionCode}}"
               class="question-card"
               th:classappend="${#lists.isEmpty(question.answers)} ? 'pending' : 'answered'"
               th:data-status="${#lists.isEmpty(question.answers)} ? 'pending' : 'answered'">

                <div class="question-header">
                    <div class="question-info">
                        <div class="student-info">
                            질문자: <span class="student-name" th:text="${question.student.name}">학생명</span>
                            (<span th:text="${question.studentId}">학번</span>)
                        </div>
                    </div>
                    <div class="question-date">
                        <div th:text="${#temporals.format(question.questionTime, 'yyyy-MM-dd')}">2024-01-01</div>
                        <div th:text="${#temporals.format(question.questionTime, 'HH:mm')}">12:00</div>
                    </div>
                </div>

                <div class="question-content" th:text="${question.content}">
                    질문 내용이 여기에 표시됩니다...
                </div>

                <!-- 답변 미리보기 (답변이 있는 경우) -->
                <div th:if="${not #lists.isEmpty(question.answers)}" class="answer-preview">
                    <div class="answer-author" th:text="${question.answers[0].professor.name + ' 교수님'}">교수님</div>
                    <div class="answer-text" th:text="${#strings.abbreviate(question.answers[0].content, 150)}">
                        답변 미리보기...
                    </div>
                </div>

                <div class="answer-status">
                    <span th:if="${#lists.isEmpty(question.answers)}" class="status-badge status-pending">
                        답변 대기
                    </span>
                    <span th:unless="${#lists.isEmpty(question.answers)}" class="status-badge status-answered">
                        답변 완료
                    </span>

                    <span class="answer-btn">
                        <span th:if="${#lists.isEmpty(question.answers)}">답변하기</span>
                        <span th:unless="${#lists.isEmpty(question.answers)}">답변 보기</span>
                    </span>
                </div>
            </a>
        </div>
    </div>
</div>

<script>
    function filterQuestions(status) {
        // 모든 필터 버튼에서 active 클래스 제거
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });

        // 클릭된 버튼에 active 클래스 추가
        event.target.classList.add('active');

        // 모든 질문 카드 가져오기
        const questionCards = document.querySelectorAll('.question-card');

        questionCards.forEach(card => {
            const cardStatus = card.getAttribute('data-status');

            if (status === 'all' || status === cardStatus) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        // 페이지 로드 시 전체 질문 표시
        filterQuestions('all');
    });
</script>
</body>
</html>